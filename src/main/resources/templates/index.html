<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Hotel Booking</title>
    <link rel="stylesheet" href="/index.css"> <!-- Підключення стилів -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <script>
        function toggleFilter() {
            const citySelect = document.querySelector("select[name='city']");
            const ratingFields = document.querySelectorAll(".rating-filter input, .rating-filter select");
            const ratingFilterDiv = document.querySelector(".rating-filter");

            // Якщо вибрано "Усі міста", вимикаємо фільтрацію та скидаємо значення
            if (citySelect.value === "") {
                ratingFields.forEach(field => field.disabled = true); // Деактивуємо фільтри
                // Скидаємо значення фільтру за рейтингом
                document.querySelector("input[name='minRating']").value = "";
                document.querySelector("input[name='maxRating']").value = "";
                document.querySelector("select[name='sortOrder']").value = "desc"; // Встановлюємо сортування за замовчуванням
                ratingFilterDiv.style.display = "none"; // Приховуємо фільтри
            } else {
                ratingFields.forEach(field => field.disabled = false); // Активуємо фільтри
                ratingFilterDiv.style.display = "block"; // Показуємо фільтри
            }
        }

        // Викликаємо функцію при завантаженні сторінки та при зміні міста
        window.onload = toggleFilter;
    </script>
</head>
<body>
<div class="container">
    <header>
        <h1>Welcome to the Hotel Booking System</h1>
        <nav>
            <ul>
                <li><a href="/register">Register</a></li>
                <li><a href="/login">Login</a></li>
                <li><a href="/profile">View Profile</a></li>
                <li><a href="/create">Create Hotel</a></li>
                <li><a href="/admin">Admin Panel</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <form method="get" th:action="@{/}">
            <div class="filter">
                <label>City:</label>
                <select name="city" th:onchange="this.form.submit(); toggleFilter();">
                    <option value="">All Cities</option>
                    <option th:each="city : ${cities}" th:value="${city}" th:text="${city}" th:selected="${selectedCity == city}"></option>
                </select>
            </div>

            <!-- Форма для фільтрації за рейтингом, доступна тільки якщо вибрано місто -->
            <div class="rating-filter" style="display: none;">
                <label>Sort by Rating:</label>
                <select name="sortOrder" onchange="this.form.submit()">
                    <option value="desc" th:selected="${sortOrder == 'desc'}">Highest to Lowest</option>
                    <option value="asc" th:selected="${sortOrder == 'asc'}">Lowest to Highest</option>
                </select>

                <div>
                    <label>Minimum Rating:</label>
                    <input type="number" step="0.1" name="minRating" th:value="${minRating}" placeholder="Enter minimum rating" />
                </div>
                <div>
                    <label>Maximum Rating:</label>
                    <input type="number" step="0.1" name="maxRating" th:value="${maxRating}" placeholder="Enter maximum rating" />
                </div>
            </div>

            <button type="submit">Filter</button>
        </form>

        <section>
            <h2>List of Hotels</h2>
            <div class="hotels-list">
                <table>
                    <thead>
                    <tr>
                        <th>Hotel Name</th>
                        <th>Address</th>
                        <th>City</th>
                        <th>Country</th>
                        <th>Contact Info</th>
                        <th>Rooms</th>
                        <th>Rating</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="hotel : ${hotels}">
                        <td th:text="${hotel.name}"></td>
                        <td th:text="${hotel.address}"></td>
                        <td th:text="${hotel.city}"></td>
                        <td th:text="${hotel.country}"></td>
                        <td th:text="${hotel.contactInfo}"></td>
                        <td>
                                    <span th:with="rating=${hotel.averageRating}">
                                        <span th:each="i : ${#numbers.sequence(1, 5)}"
                                              th:classappend="${i <= rating} ? 'fa fa-star checked' : 'fa fa-star'"></span>
                                        <span th:text="'(' + ${#numbers.formatDecimal(rating, 1, 1)} + ')'"></span>
                                    </span>
                        </td>
                        <td><a th:href="@{/{hotelId}/rooms(hotelId=${hotel.id})}">View Rooms</a></td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </section>
    </main>

    <footer>
        <p>&copy; 2025 Hotel Booking System</p>
    </footer>
</div>
</body>
</html>
