<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Admin Panel</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="/admin-panel.css">
</head>
<body>
<h1>üè® Admin Dashboard</h1>

<!-- Sidebar -->
<div class="sidebar">
    <div class="nav-tabs">
        <a href="/" class="home-button">
            <i class="fas fa-arrow-left"></i> –ì–æ–ª–æ–≤–Ω–∞
        </a>
        <div class="tab-link active" data-tab="hotels">
            <i class="fas fa-hotel"></i> –ì–æ—Ç–µ–ª—ñ
        </div>
        <div class="tab-link" data-tab="rooms">
            <i class="fas fa-bed"></i> –ö—ñ–º–Ω–∞—Ç–∏
        </div>
        <div class="tab-link" data-tab="users">
            <i class="fas fa-users"></i> –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ
        </div>
        <div class="tab-link" data-tab="requests">
            <i class="fas fa-envelope"></i> –ó–∞–ø–∏—Ç–∏
        </div>
        <div class="tab-link" data-tab="sync">
            <i class="fas fa-sync-alt"></i> –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è
        </div>
    </div>
</div>

<!-- Main Content -->
<div class="content">
    <div id="hotels" class="tab-content">
        <h2>Manage Hotels</h2>
        <table>
            <thead>
            <tr>
                <th>Hotel Name</th>
                <th>City</th>
                <th>Country</th>
                <th>Average Rating</th>
                <th>Actions</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="hotel : ${hotels}">
                <td th:text="${hotel.name}"></td>
                <td th:text="${hotel.city}"></td>
                <td th:text="${hotel.country}"></td>
                <td th:text="${hotel.averageRating}"></td>
                <td>
                    <a th:href="@{/admin/editHotel/{hotelId}(hotelId=${hotel.id})}">Edit</a> |
                    <a th:href="@{/admin/deleteHotel/{hotelId}(hotelId=${hotel.id})}">Delete</a>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- Rooms tab -->
<div id="rooms" class="tab-content" style="display: none;">
    <h2>Manage Rooms</h2>
    <table>
        <thead>
        <tr>
            <th>Room Type</th>
            <th>Hotel</th>
            <th>Price</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="room : ${rooms}">
            <td th:text="${room.type}"></td>
            <td th:text="${room.hotel.name}"></td>
            <td th:text="${room.price}"></td>
            <td>
                <a th:href="@{/admin/editRoom/{roomId}(roomId=${room.id})}">Edit</a> |
                <a th:href="@{/admin/deleteRoom/{roomId}(roomId=${room.id})}">Delete</a>
            </td>
        </tr>
        </tbody>
    </table>
</div>

<!-- Users tab (–≤–∏–¥–∞–ª–∏—Ç–∏ –¥—É–±–ª—å–æ–≤–∞–Ω–∏–π –±–ª–æ–∫) -->
<div id="users" class="tab-content" style="display: none;">
    <div th:fragment="users">
        <h2>Manage Users</h2>

        <!-- –ü–æ—à—É–∫–æ–≤–∞ —Ñ–æ—Ä–º–∞ -->
        <form id="userSearchForm" class="user-search-form">
            <input type="email" id="searchEmail" name="email" placeholder="Search by email..." required>
            <button type="submit">Search</button>
        </form>

        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ -->
        <div id="userResults">
            <table class="user-table">
                <thead>
                <tr>
                    <th>Email</th>
                    <th>Roles</th>
                    <th>Action</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="user : ${searchedUsers}">
                    <td th:text="${user.email}"></td>
                    <td>
                            <span th:each="role : ${user.roles}"
                                  th:text="${role} + ' '"></span>
                    </td>
                    <td>
                        <form th:action="@{/admin/grant-admin/{userId}(userId=${user.id})}"
                              method="post">
                            <button type="submit">Grant Admin</button>
                        </form>
                    </td>
                </tr>
                <tr th:if="${searchedUsers.isEmpty()}">
                    <td colspan="3">No users found</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Requests tab -->
<div id="requests" class="tab-content" style="display: none;">
    <h2>Manager Role Requests</h2>
    <table>
        <thead>
        <tr>
            <th>User</th>
            <th>Request Date</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody>
        <!-- –î–æ–¥–∞–Ω–æ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É –Ω–∞ –ø—É—Å—Ç–∏–π —Å–ø–∏—Å–æ–∫ -->
        <tr th:if="${requests.isEmpty()}">
            <td colspan="3">No pending requests</td>
        </tr>
        <tr th:each="request : ${requests}">
            <td th:text="${request.user.email}"></td>
            <td th:text="${#temporals.format(request.requestDate, 'dd-MM-yyyy HH:mm')}"></td>
            <td>
                <form th:action="@{/admin/approve-request/{id}(id=${request.id})}" method="post">
                    <button type="submit">Approve</button>
                </form>
            </td>
        </tr>
        </tbody>
    </table>
</div>
<!-- Synchronization tab -->
<div id="sync" class="tab-content" style="display: none;">
    <h2>Sync Hotels via Amadeus API</h2>
    <form id="syncForm">
        <label for="cityCode">City Code:</label>
        <input type="text" id="cityCode" name="cityCode" required>
        <button type="submit">Sync</button>
    </form>

    <h3>Available City Codes:</h3>
    <ul>
        <li>PAR - Paris</li>
        <li>NYC - New York</li>
        <li>LON - London</li>
        <li>BER - Berlin</li>
        <li>ROM - Rome</li>
        <li>AMS - Amsterdam</li>
        <li>BCN - Barcelona</li>
    </ul>

    <div id="syncResult"></div>
</div>

<script>

    const tabs = document.querySelectorAll('.tab-link');
    const tabContents = document.querySelectorAll('.tab-content');

    tabs.forEach(tab => {
        tab.addEventListener('click', function() {
            const targetTab = this.dataset.tab;
            const currentActive = document.querySelector('.tab-content:not([style*="display: none"])');

            // –ê–Ω—ñ–º–∞—Ü—ñ—è –≤–∏—Ö–æ–¥—É
            if(currentActive) {
                currentActive.style.opacity = '0';
                currentActive.style.transform = 'translateX(30px)';
            }

            setTimeout(() => {
                tabs.forEach(t => t.classList.remove('active'));
                tabContents.forEach(content => {
                    content.style.display = 'none';
                    content.style.opacity = '0';
                    content.style.transform = 'translateX(30px)';
                });

                this.classList.add('active');
                const targetContent = document.getElementById(targetTab);
                targetContent.style.display = 'block';

                // –ê–Ω—ñ–º–∞—Ü—ñ—è –≤—Ö–æ–¥—É
                setTimeout(() => {
                    targetContent.style.opacity = '1';
                    targetContent.style.transform = 'translateX(0)';
                }, 50);
            }, 300);
        });
    });

    // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –ø–µ—Ä—à–æ—ó –≤–∫–ª–∞–¥–∫–∏
    document.querySelector('.tab-link.active').click();

    // Handle user search form
    // –û–±—Ä–æ–±–Ω–∏–∫ —Ñ–æ—Ä–º–∏ –ø–æ—à—É–∫—É
    document.getElementById('userSearchForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const email = document.getElementById('searchEmail').value;

        fetch(`/admin/searchUser?email=${encodeURIComponent(email)}`)
            .then(response => {
                if (!response.ok) throw new Error('–ü–æ–º–∏–ª–∫–∞ –º–µ—Ä–µ–∂—ñ');
                return response.text();
            })
            .then(html => {
                document.getElementById('userResults').innerHTML = html;
            })
            .catch(error => {
                console.error('–ü–æ–º–∏–ª–∫–∞:', error);
                document.getElementById('userResults').innerHTML = `
                <tr><td colspan="3">–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è</td></tr>`;
            });
    });
</script>

</body>
</html>
