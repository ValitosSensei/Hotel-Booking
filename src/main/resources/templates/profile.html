<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>User Profile</title>
    <link rel="stylesheet" href="/css/profile.css">


</head>
<body>


<div id="managerRequestModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <form id="managerRequestForm" th:action="@{/profile/request-manager}" method="post">
            <label>Назва готелю:</label>
            <input type="text" name="hotelName" required>

            <label>Адреса готелю:</label>
            <input type="text" name="hotelAddress" required>

            <button type="submit">Надіслати</button>
        </form>
    </div>
</div>

<div class="header">
    <a href="/" class="logo-link">
        <img src="/images/logo.png" alt="Logo" class="logo">
        <h1 class="site-name">Hotel Booking</h1>
    </a>
    <form th:action="@{/logout}" method="post" class="logout-form">
        <button type="submit" class="logout-btn">Вийти</button>
    </form>
</div>

<div th:if="${message}">
    <p style="color: green;" th:text="${message}"></p>
</div>
<div th:if="${error}">
    <p style="color: red;" th:text="${error}"></p>
</div>

<div class="container">
    <div class="sidebar">
        <!-- Navigation tabs -->
        <button class="tab-link active" onclick="openTab(event, 'personalInfo')">Персональна інформація</button>
        <button class="tab-link" onclick="openTab(event, 'bookings')">Історія бронювань</button>
        <button class="tab-link" th:if="${isManager}" onclick="openTab(event, 'manager')">Управління готелями</button>
    </div>

    <!-- Tab content -->
    <div class="tab-content-wrapper">
        <div id="personalInfo" class="tab-content">
            <h2>Personal Information</h2>
            <p>ID: <span th:text="${user.id}"></span></p>
            <p>Name: <span th:text="${user.firstName + ' ' + user.lastName}"></span></p>
            <p>Email: <span th:text="${user.email}"></span></p>
            <p>Phone: <span th:text="${user.phone}"></span></p>

            <div th:unless="${#lists.contains(user.roles, T(org.booking.hotelbooking.Entity.Role).ROLE_MANAGER)}">
                <button onclick="openManagerRequestModal()">Надіслати запит на роль менеджера</button>
            </div>
        </div>

        <div id="bookings" class="tab-content">
            <h2>Booking History</h2>
            <table>
                <thead>
                <tr>
                    <th>Booking ID</th>
                    <th>Room Number</th>
                    <th>Check-in Date</th>
                    <th>Check-out Date</th>
                    <th>Від кого</th>
                    <th>Transfer</th>
                    <th>Status</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="booking : ${user.bookings}">
                    <td th:text="${booking.id}"></td>
                    <td th:text="${booking.room.roomNumber}"></td>
                    <td th:text="${#temporals.format(booking.checkInDate, 'dd-MM-yyyy')}"></td>
                    <td th:text="${#temporals.format(booking.checkOutDate, 'dd-MM-yyyy')}"></td>
                    <td th:text="${booking.transferredFrom?.email} ?: '—'"></td> <!-- Відображення передавача -->

                    <!-- Дії (Скасування / Передача) -->
                    <td>
                        <div th:if="${booking.status.name() != 'COMPLETED'}">
                            <form th:action="@{/bookings/{bookingId}/cancel(bookingId=${booking.id})}" method="post" style="display:inline;">
                                <button type="submit">Скасувати</button>
                            </form>
                            <button th:onclick="'openTransferModal(' + ${booking.id} + ')'">Передати</button>
                        </div>
                        <span th:if="${booking.status.name() == 'COMPLETED'}" style="color: gray;">—</span>
                    </td>

                    <!-- Статус -->
                    <td>
                        <span th:text="${booking.status?.name()}"></span>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>

        <div id="manager" class="tab-content">
            <h2>Управління вашими готелями</h2>
            <a th:href="@{/manager/create-hotel}">
                <button>Створити новий готель</button>
            </a>
            <div th:if="${not #lists.isEmpty(userHotels)}">
                <table>
                    <thead>
                    <tr>
                        <th>Назва готелю</th>
                        <th>Місто</th>
                        <th>Дії</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="hotel : ${userHotels}">
                        <td th:text="${hotel.name}"></td>
                        <td th:text="${hotel.city}"></td>
                        <td>
                            <a th:href="@{/manager/hotels/{hotelId}(hotelId=${hotel.id}, userId=${user.id})}">Редагувати готель</a>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <div th:if="${#lists.isEmpty(userHotels)}">
                <p>У вас поки немає готелів для управління.</p>
            </div>
        </div>
    </div>
</div>
<div id="transferBookingModal" class="modal">
    <span class="close" onclick="closeModal()">&times;</span>
    <h2>Передача бронювання</h2>
    <form id="transferForm" method="post">
        <input type="hidden" id="transferBookingId" name="bookingId">
        <label>Email нового користувача:
            <input type="email" name="newUserEmail" required>
        </label>
        <button type="submit" class="modal-btn">Запросити передачу</button>
        <button type="button" class="modal-btn cancel-btn" onclick="closeModal()">Скасувати</button>
    </form>
</div>
<div class="modal-overlay" onclick="closeModal()"></div>
<script th:src="@{/js/profile.js}">

</script>

</body>
</html>
