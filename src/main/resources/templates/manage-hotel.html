<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>Керування готелем</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="/manager-panel.css">
</head>
<body>
<!-- Бокова панель -->
<div class="sidebar">
    <div class="nav-tabs">
        <a th:href="@{/profile(userId=${userId})}" class="home-button">
            <i class="fas fa-arrow-left"></i> Назад
        </a>
        <div class="tab-link active" data-tab="hotelInfo">
            <i class="fas fa-info-circle"></i> Інформація
        </div>
        <!-- Додані кнопки -->
        <div class="tab-link" onclick="openModal('editHotelModal')">
            <i class="fas fa-edit"></i> Редагувати готель
        </div>
        <div class="tab-link" onclick="openModal('addRoomModal')">
            <i class="fas fa-plus"></i> Додати кімнату
        </div>
    </div>
</div>

<div class="tab-container">
    <h1 th:text="${hotel.name}" class="hotel-title">Назва готелю</h1>
    <!-- Вкладки -->
    <div id="hotelInfo" class="tab active">
        <div class="hotel-info">
            <h2>Інформація про готель</h2>
            <p><strong>Адреса:</strong> <span th:text="${hotel.address}"></span></p>
            <p><strong>Місто:</strong> <span th:text="${hotel.city}"></span></p>
            <p><strong>Країна:</strong> <span th:text="${hotel.country}"></span></p>
        </div>
    </div>

    <div id="hotelRooms" class="tab">
            <div class="rooms-section">
                <h2>Кімнати готелю</h2>
                <table class="rooms-table">
                    <thead>
                    <tr>
                        <th>Номер</th>
                        <th>Тип</th>
                        <th>Ціна</th>
                        <th>Доступність</th>
                        <th>Дії</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="room : ${hotel.rooms}">
                        <td th:text="${room.roomNumber}"></td>
                        <td th:text="${room.type}"></td>
                        <td th:text="${room.price}"></td>
                        <td th:text="${room.availableForDates ? 'Так' : 'Ні'}"></td>
                        <td>
                            <button th:onclick="'openEditRoomModal(' + ${room.id} + ', ' + ${userId} + ')'">Редагувати</button>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
    </div>

</div>

<!-- Модальні вікна редагування -->
<div id="editHotelModal" class="modal">
    <span class="close" onclick="closeModal()">&times;</span>
    <h2>Редагування готелю</h2>
    <form th:action="@{/manager/editHotel/{hotelId}(hotelId=${hotel.id}, userId=${userId})}" method="post">
        <label>Назва: <input type="text" th:value="${hotel.name}" name="name" required></label>
        <label>Адреса: <input type="text" th:value="${hotel.address}" name="address" required></label>
        <label>Місто: <input type="text" th:value="${hotel.city}" name="city" required></label>
        <label>Країна: <input type="text" th:value="${hotel.country}" name="country" required></label>
        <button type="submit">Зберегти</button>
        <button type="button" onclick="closeModal()">Скасувати</button>
    </form>
</div>

<div id="addRoomModal" class="modal">
    <span class="close" onclick="closeModal()">&times;</span>
    <h2>Додати кімнату</h2>
    <form th:action="@{/manager/hotels/{hotelId}/rooms/create(hotelId=${hotel.id}, userId=${userId})}" method="post">
        <label>Номер: <input type="text" name="roomNumber" required></label>
        <label>Тип: <input type="text" name="type" required></label>
        <label>Ціна: <input type="number" name="price" step="0.01" required></label>
        <label>Доступність:
            <select name="availableForDates">
                <option value="true">Так</option>
                <option value="false">Ні</option>
            </select>
        </label>
        <button type="submit">Додати</button>
        <button type="button" onclick="closeModal()">Скасувати</button>
    </form>
</div>

<div id="editRoomModal" class="modal">
    <span class="close" onclick="closeModal()">&times;</span>
    <h2>Редагування кімнати</h2>
    <form id="editRoomForm" method="post">
        <input type="hidden" name="roomId" id="editRoomId">
        <input type="hidden" name="userId" th:value="${userId}">
        <label>Номер: <input type="text" id="editRoomNumber" name="roomNumber" required></label>
        <label>Тип: <input type="text" id="editRoomType" name="type" required></label>
        <label>Ціна: <input type="number" id="editRoomPrice" name="price" step="0.01" required></label>
        <label>Доступність: <input type="checkbox" id="editRoomAvailable" name="availableForDates"></label>
        <button type="submit">Зберегти</button>
        <button type="button" onclick="closeModal()">Скасувати</button>
    </form>
</div>

<div class="modal-overlay" onclick="closeModal()"></div>

<script>
    function openTab(tabId) {
        document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
        document.querySelectorAll('.tab-button').forEach(button => button.classList.remove('active'));

        document.getElementById(tabId).classList.add('active');
        event.target.classList.add('active');
    }
    document.querySelectorAll('.tab-link').forEach(link => {
        link.addEventListener('click', function() {
            if (!this.dataset.tab) return; // Ігнорувати кнопки без data-tab
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-link').forEach(l => l.classList.remove('active'));
            this.classList.add('active');
            document.getElementById(this.dataset.tab).classList.add('active');
        });
    });

    function openModal(modalId) {
        const modal = document.getElementById(modalId);
        const overlay = document.querySelector('.modal-overlay');
        overlay.style.display = 'block';
        modal.style.display = 'block';
        setTimeout(() => {
            overlay.style.opacity = '1';
            modal.style.opacity = '1';
        }, 10);
    }

    function closeModal() {
        const modals = document.querySelectorAll('.modal');
        const overlay = document.querySelector('.modal-overlay');
        modals.forEach(modal => {
            modal.style.display = 'none';
        });
        overlay.style.display = 'none';
    }

    async function openEditRoomModal(roomId, userId) {
        try {
            const response = await fetch(`/manager/editRoom/${roomId}?userId=${userId}`);
            if (!response.ok) throw new Error("Помилка сервера: " + response.status);
            const room = await response.json();

            document.getElementById('editRoomId').value = room.id;
            document.getElementById('editRoomNumber').value = room.roomNumber;
            document.getElementById('editRoomType').value = room.type;
            document.getElementById('editRoomPrice').value = room.price;
            document.getElementById('editRoomAvailable').checked = room.availableForDates;

            openModal('editRoomModal');
        } catch (error) {
            console.error('Помилка:', error);
            alert('Не вдалося завантажити дані кімнати: ' + error.message);
        }
    }

    document.getElementById('editRoomForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = new FormData(e.target);
        const roomId = formData.get('roomId');

        try {
            await fetch(`/manager/editRoom/${roomId}`, {
                method: 'POST',
                body: formData
            });
            location.reload();
        } catch (error) {
            console.error('Помилка:', error);
            alert('Не вдалося зберегти зміни');
        }
    });
</script>